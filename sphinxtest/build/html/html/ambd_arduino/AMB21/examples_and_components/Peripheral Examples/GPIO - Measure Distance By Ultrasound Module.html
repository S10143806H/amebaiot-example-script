<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPIO - Measure Distance By Ultrasound Module &mdash; 123 123 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="GPIO - Measure Temperature and Humidity" href="GPIO%20-%20Measure%20Temperature%20and%20Humidity.html" />
    <link rel="prev" title="Flash Memory - Use Flash Memory Larger Than 4K" href="Flash%20Memory%20-%20Use%20Flash%20Memory%20Larger%20Than%204K.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> 123
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Open Source SDKs</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../arduino_index.html">Arduino SDK</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">AMB21/AMB22 (RTL8722DM/RTL8722CSM)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../getting_started/ambd_getting_started.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../release_history/Release_History.html">Release History</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Examples &amp; Components</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../Basic%20Examples.html">Basic Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Network%20Examples/index.html">Network Examples</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Peripheral Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Community%20Examples/index.html">Community Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Components%20Used.html">Components Used</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../api_documents/index.html">API Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../resources/index.html">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../support/index.html">Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../AMB23/index.html">AMB23 (RTL8722DM MINI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../BW16_/index.html">BW16 (RTL8720DN)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ambd_micropython/micropython_index.html">MicroPython SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ambd_sdk/source/index.html">Standard SDK</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Download</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../download/AMB21_download.html">AMB21/AMB22 (RTL8722DM/RTL8722CSM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../download/AMB23_download.html">AMB23 (RTL8722DM MINI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../download/BW16_download.html">BW16 (RTL8720DN)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">123</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../arduino_index.html">Arduino SDK</a> &raquo;</li>
          <li><a href="../../index.html">AMB21/AMB22 (RTL8722DM/RTL8722CSM)</a> &raquo;</li>
          <li><a href="../index.html">Examples &amp; Components</a> &raquo;</li>
          <li><a href="index.html">Peripheral Examples</a> &raquo;</li>
      <li>GPIO - Measure Distance By Ultrasound Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/ambd_arduino/AMB21/examples_and_components/Peripheral Examples/GPIO - Measure Distance By Ultrasound Module.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gpio-measure-distance-by-ultrasound-module">
<h1>GPIO - Measure Distance By Ultrasound Module<a class="headerlink" href="#gpio-measure-distance-by-ultrasound-module" title="Permalink to this heading"></a></h1>
<p><span class="raw-html"><p style="color:#E67E22; font-size:24px"></span>
<strong>Preparation</strong>
<span class="raw-html"></p></span></p>
<blockquote>
<div><ul class="simple">
<li><p>AmebaD [AMB21 / AMB22 / AMB23 / BW16] x 1</p></li>
<li><p>HC-SR04 Ultrasonic x 1</p></li>
<li><p>Dropping resistor or Level converter</p></li>
</ul>
</div></blockquote>
<p><span class="raw-html"><p style="color:#E67E22; font-size:24px"></span>
<strong>Example</strong>
<span class="raw-html"></p></span></p>
<div class="line-block">
<div class="line">HC-SR04 is a module that uses ultrasound to measure the distance. It
looks like a pair of eyes in its appearance, therefore it’s often
installed onto robot-vehicle or mechanical bugs to be their eyes.</div>
<div class="line">The way it works is that first we “toggle high” the TRIG pin (that is to
pull high then pull low). The HC-SR04 would send eight 40kHz sound wave
signal and pull high the ECHO pin. When the sound wave returns back, it
pull low the ECHO pin.</div>
</div>
<p><a class="reference internal" href="../../../../_images/image150.png"><img alt="1" src="../../../../_images/image150.png" style="width: 551.5px; height: 339.5px;" /></a></p>
<div class="line-block">
<div class="line">Assume the velocity of sound is 340 m/s, the time it takes for the sound to advance 1 cm in the air is 340*100*10^-6 = 29 us.</div>
<div class="line">The sound wave actually travels twice the distance between HC-SR04 and the object, therefore the distance can be calculated by (time/29) / 2 = time / 58.</div>
<div class="line">The working voltage of HC-SR04 is 5V. When we pull high the ECHO pin to 5V, the voltage might cause
damage to the GPIO pin of Ameba. To avoid this situation, we need to
drop the voltage as follows:</div>
</div>
<p><strong>AMB21 / AMB22</strong> Wiring Diagram:</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image246.png"><img alt="2" src="../../../../_images/image246.png" style="width: 609.0px; height: 352.79999999999995px;" /></a></p>
</div></blockquote>
<p><strong>AMB23</strong> Wiring Diagram:</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image2-13.png"><img alt="2-1" src="../../../../_images/image2-13.png" style="width: 509.5px; height: 384.0px;" /></a></p>
</div></blockquote>
<p><strong>BW16</strong> Wiring Diagram:</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image2-3.png"><img alt="2-3" src="../../../../_images/image2-3.png" style="width: 469.5px; height: 373.5px;" /></a></p>
</div></blockquote>
<div class="line-block">
<div class="line">We pick the resistors with resistance 1:2, in the example we use 10kΩ and 20kΩ.</div>
<div class="line">If you do not have resistors in hand, you can use level converter instead.The TXB0108 8 channel level
converter is a suitable example:</div>
</div>
<p><strong>AMB21 / AMB22</strong> Wiring Diagram:</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image331.png"><img alt="3" src="../../../../_images/image331.png" style="width: 525.35px; height: 379.04999999999995px;" /></a></p>
</div></blockquote>
<p><strong>AMB23</strong> Wiring Diagram:</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image3-13.png"><img alt="3-1" src="../../../../_images/image3-13.png" style="width: 445.05px; height: 315.0px;" /></a></p>
</div></blockquote>
<p><strong>BW16</strong> Wiring Diagram:</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image3-3.png"><img alt="3-3" src="../../../../_images/image3-3.png" style="width: 513.0px; height: 340.65000000000003px;" /></a></p>
</div></blockquote>
<p>Next, open the sample code in <code class="docutils literal notranslate"><span class="pre">“File”</span> <span class="pre">-&gt;</span> <span class="pre">“Examples”</span> <span class="pre">-&gt;</span> <span class="pre">“AmebaGPIO”</span> <span class="pre">-&gt;</span> <span class="pre">“HCSR04_Ultrasonic”</span></code></p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image424.png"><img alt="4" src="../../../../_images/image424.png" style="width: 329.45000000000005px; height: 553.3000000000001px;" /></a></p>
</div></blockquote>
<p>Compile and upload to Ameba, then press the reset button. Open the Serial Monitor, the calculated result is
output to serial monitor every 2 seconds.</p>
<blockquote>
<div><p><a class="reference internal" href="../../../../_images/image516.png"><img alt="5" src="../../../../_images/image516.png" style="width: 649.0px; height: 372.0px;" /></a></p>
</div></blockquote>
<p>Note that the HCSR04 module uses the reflection of sound wave to calculate the distance, thus
the result can be affected by the surface material of the object (e.g.,
harsh surface tends to cause scattering of sound wave, and soft surface
may cause the sound wave to be absorbed).</p>
<p><span class="raw-html"><p style="color:#E67E22; font-size:24px"></span>
<strong>Code Reference</strong>
<span class="raw-html"></p></span></p>
<p>Before the measurement starts, we need to pull high the TRIG pin for
10us and then pull low. By doing this, we are telling the HC-SR04 that
we are about to start the measurement:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">digitalWrite</span><span class="p">(</span><span class="n">trigger_pin</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span><span class="w"></span>
<span class="n">delayMicroseconds</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="n">digitalWrite</span><span class="p">(</span><span class="n">trigger_pin</span><span class="p">,</span><span class="w"> </span><span class="n">LOW</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Next, use pulseIn to measure the time when the ECHO pin is pulled high.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pulseIn</span><span class="w"> </span><span class="p">(</span><span class="n">echo_pin</span><span class="p">,</span><span class="w"> </span><span class="n">HIGH</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Finally, use the formula to calculate the distance.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">58</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Flash%20Memory%20-%20Use%20Flash%20Memory%20Larger%20Than%204K.html" class="btn btn-neutral float-left" title="Flash Memory - Use Flash Memory Larger Than 4K" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="GPIO%20-%20Measure%20Temperature%20and%20Humidity.html" class="btn btn-neutral float-right" title="GPIO - Measure Temperature and Humidity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, 123.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>